#!/bin/bash

# Docker 静态安装脚本 - 在线安装器
# 使用方法: curl -sL https://github.com/ellermister/docker-static-install/raw/main/docker | bash

echo "🐳 Docker 静态安装脚本"
echo "======================"

# 检查是否为root用户
if [ "$EUID" -ne 0 ]; then
    echo "❌ 错误: 请使用root权限运行此脚本"
    echo "💡 使用方法: curl -sL https://github.com/ellermister/docker-static-install/raw/main/docker | sudo bash"
    exit 1
fi

# 检查系统兼容性
if ! command -v apt >/dev/null 2>&1 && ! command -v apt-get >/dev/null 2>&1; then
    echo "❌ 错误: 此脚本仅支持基于APT的系统 (Ubuntu/Debian)"
    exit 1
fi

echo "✅ 系统检查通过"

# 下载完整安装脚本
echo "📥 正在下载完整安装脚本..."
INSTALL_SCRIPT_URL="https://github.com/ellermister/docker-static-install/raw/main/install.sh"

# 创建临时文件
TEMP_SCRIPT=$(mktemp)

# 下载脚本
if curl -sL "$INSTALL_SCRIPT_URL" -o "$TEMP_SCRIPT"; then
    echo "✅ 脚本下载完成"
    
    # 设置执行权限
    chmod +x "$TEMP_SCRIPT"
    
    # 执行安装脚本
    echo "🚀 开始执行安装..."
    echo "===================="
    "$TEMP_SCRIPT"
    
    # 清理临时文件
    rm -f "$TEMP_SCRIPT"
else
    echo "❌ 脚本下载失败，请检查网络连接"
    rm -f "$TEMP_SCRIPT"
    exit 1
fi
